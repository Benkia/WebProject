
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAYxT7MA77NOZdiXVOHm3iSvX96jfwdhBQ" type="text/javascript"></script>
<script src="~/Scripts/jquery-1.10.2.js"></script>
@{
    ViewBag.Title = "Maps";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Fans on the map</h2>

<div id="map_canvas" style="height: 550px;"></div>

<script type="text/javascript">



    $(document).ready(function () {
        Initialize();
    });

    // Where all the fun happens
    function Initialize() {
        $.ajax({
            url: '@Url.Action("DataMap", "Home")',
            type: 'GET',
            success: function (data) {
                var geocoder;
                geocoder = new google.maps.Geocoder();
                // Google has tweaked their interface somewhat - this tells the api to use that new UI
                google.maps.visualRefresh = true;

                // These are options that set initial zoom level, where the map is centered globally to start, and the type of map to show
                var mapOptions = {
                    zoom: 8,
                    center: new google.maps.LatLng(31.969738, 34.7727872),
                    mapTypeId: google.maps.MapTypeId.G_NORMAL_MAP
                };

                // This makes the div with id "map_canvas" a google map
                var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

                // Using the JQuery "each" selector to iterate through the JSON list and drop marker pins
                $.each(data, function (i, item) {
                    geocoder.geocode({ 'address': item.Address }, function (results, status) {
                        if (status == 'OK') {
                            var marker = new google.maps.Marker({
                                'position': results[0].geometry.location,
                                'map': map,
                            });
                            // Make the marker-pin blue!
                            marker.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png')
                        }
                    });



                })
            }
        })
    }


</script>